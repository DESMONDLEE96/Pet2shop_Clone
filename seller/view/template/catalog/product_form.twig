{{ header }}{{ column_left }}
<div id="content">
  <div class="page-header">
    <div class="container-fluid">
      <div class="pull-right">
        {% if product_id == 0 %}
          <button class="btn btn-primary add-product">Add Product</button>  
        {% else %}
          <button class="btn btn-primary edit-product">Edit Product</button>
        {% endif %}
        <a href="{{ cancel }}" data-toggle="tooltip" title="{{ button_cancel }}" class="btn btn-default"><i class="fa fa-reply"></i></a></div>
      <h1>{{ heading_title }}</h1>
      <ul class="breadcrumb">
        {% for breadcrumb in breadcrumbs %}
          <li><a href="{{ breadcrumb.href }}">{{ breadcrumb.text }}</a></li>
        {% endfor %}
      </ul>
    </div>
  </div>
  <div class="container-fluid"> 
    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title"><i class="fa fa-pencil"></i> {{ text_form }}</h3>
      </div>
      <div class="panel-body">
        <form action="{{ action }}" method="post" enctype="multipart/form-data" id="form-product" class="form-horizontal">
          <ul class="nav nav-tabs">
            <li class="active"><a href="#tab-general" data-toggle="tab">{{ tab_general }}</a></li>
            <li><a href="#tab-data" data-toggle="tab">{{ tab_data }}</a></li>
            <li><a href="#tab-links" data-toggle="tab">{{ tab_links }}</a></li>
            {# <li><a href="#tab-discount" data-toggle="tab">{{ tab_discount }}</a></li>
            <li><a href="#tab-special" data-toggle="tab">{{ tab_special }}</a></li>             #}
          </ul>
          <div class="tab-content">
            <div class="tab-pane active" id="tab-general">
              <ul class="nav nav-tabs" id="language">
                {% for language in languages %}
                  <li><a href="#language{{ language.language_id }}" data-toggle="tab"><img src="language/{{ language.code }}/{{ language.code }}.png" title="{{ language.name }}"/> {{ language.name }}</a></li>
                {% endfor %}
              </ul>
              <div class="tab-content">{% for language in languages %}
                  <div class="tab-pane" id="language{{ language.language_id }}">
                    {% if product_id %}
                    <div class="form-group">
                      <label class="col-sm-2 control-label">Total Views</label>
                      <div class="col-sm-10">
                          <label class="radio-inline"><i class="fa fa-eye"></i> &nbsp;{{ viewed }}</label>
                      </div>
                    </div>
                    <div class="form-group">
                      <label class="col-sm-2 control-label">Total Order Quantity</label>
                      <div class="col-sm-10">
                          <label class="radio-inline">&nbsp;{{ total_order }}</label>
                      </div>
                    </div>
                    {% endif %}
                    <div class="form-group required">
                      <label class="col-sm-2 control-label" for="input-name{{ language.language_id }}">{{ entry_name }}</label>
                      <div class="col-sm-10">
                        <input type="text" name="product_description[{{ language.language_id }}][name]" value="{{ product_description[language.language_id] ? product_description[language.language_id].name }}" placeholder="{{ entry_name }}" id="input-name{{ language.language_id }}" class="form-control"/>
                        {% if error_name[language.language_id] %}
                          <div class="text-danger">{{ error_name[language.language_id] }}</div>
                        {% endif %} </div>
                    </div>
                    <div class="form-group">
                      <label class="col-sm-2 control-label" for="input-description{{ language.language_id }}">{{ entry_description }}</label>
                      <div class="col-sm-10">
                        <textarea name="product_description[{{ language.language_id }}][description]" placeholder="{{ entry_description }}" id="input-description{{ language.language_id }}" data-toggle="summernote" data-lang="{{ summernote }}" class="form-control">{{ product_description[language.language_id] ? product_description[language.language_id].description }}</textarea>
                      </div>
                    </div>
                    <div class="form-group required">
                      <label class="col-sm-2 control-label" for="input-meta-title{{ language.language_id }}">{{ entry_meta_title }}</label>
                      <div class="col-sm-10">
                        <input type="text" name="product_description[{{ language.language_id }}][meta_title]" value="{{ product_description[language.language_id] ? product_description[language.language_id].meta_title }}" placeholder="{{ entry_meta_title }}" id="input-meta-title{{ language.language_id }}" class="form-control"/>
                        {% if error_meta_title[language.language_id] %}
                          <div class="text-danger">{{ error_meta_title[language.language_id] }}</div>
                        {% endif %} </div>
                    </div>
                  </div>
                {% endfor %}</div>
            </div>
            <div class="tab-pane" id="tab-data">
              <div class="form-group required">
                <label class="col-sm-2 control-label" for="input-model">{{ entry_model }}</label>
                <div class="col-sm-10">
                  <input type="text" name="model" value="{{ model }}" placeholder="{{ entry_model }}" id="input-model" class="form-control"/>
                  {% if error_model %}
                    <div class="text-danger">{{ error_model }}</div>
                  {% endif %}</div>
              </div>
              <div class="form-group">
                <label class="col-sm-2 control-label" for="input-sku"><span data-toggle="tooltip" title="{{ help_sku }}">{{ entry_sku }}</span></label>
                <div class="col-sm-10">
                  <input type="text" name="sku" value="{{ sku }}" placeholder="{{ entry_sku }}" id="input-sku" class="form-control"/>
                </div>
              </div>
              <div class="form-group">
                <label class="col-sm-2 control-label" for="input-location">{{ entry_location }}</label>
                <div class="col-sm-10">
                  <input type="text" name="location" value="{{ location }}" placeholder="{{ entry_location }}" id="input-location" class="form-control"/>
                </div>
              </div>
              <div class="form-group">
                <label class="col-sm-2 control-label" for="input-price">{{ entry_price }}</label>
                <div class="col-sm-10">
                  <input type="text" name="price" value="{{ price }}" placeholder="{{ entry_price }}" id="input-price" class="form-control"/>
                </div>
              </div>
              <div class="form-group">
                <label class="col-sm-2 control-label" for="input-quantity">{{ entry_quantity }}</label>
                <div class="col-sm-10">
                  <input type="text" name="quantity" value="{{ quantity }}" placeholder="{{ entry_quantity }}" id="input-quantity" class="form-control"/>
                </div>
              </div>
              <div class="form-group">
                <label class="col-sm-2 control-label" for="input-variation">Option</label>
                <div class="col-sm-10">
                  <p class="enable-variation" style={% if variation.variation1Name %} "display:none" {% else %} "display:block" {% endif %}>Enable Option</p>
                  <p class="disable-variation" style={% if variation.variation1Name %} "display:block" {% else %} "display:none" {% endif %}>Disable Option</p>

                  <div class="variation-container" style={% if variation.variation1Name %} "display:block" {% else %} "display:none" {% endif %}>

                    <div class="variation-1">
                      <label class="control-label" for="input-variation">Option 1</label>
                      <table class="table table-v1">
                        <tr class="variation-name">
                          <td>Name</td>
                          <td><input type="text" placeholder="Variation Name" value="{{ variation.variation1Name }}" name="v1-name" class="form-control" maxlength="14" /></td><td></td>
                        </tr>
                        <tr class="v1-option-tr">
                          <td>Options</td>
                          <td><input type="text" placeholder="Enter Options. Eg:Red" value="{{ variation.variation1Options[0] }}" class="form-control" maxlength="14"/></td>
                          <td>
                            <i class="fa fa-arrow-circle-up" aria-hidden="true"></i> 
                            <i class="fa fa-arrow-circle-down" aria-hidden="true"></i>
                            <i class="fa fa-times-circle" aria-hidden="true"></i>
                          </td>
                        </tr>
                        {% for n in variation.variation1Options|slice(1, variation.variation1Options|length) %}
                          <tr class="v1-option-tr">
                            <td></td>
                            <td><input type="text" placeholder="Enter Options. Eg:Red" value="{{ n }}" class="form-control" maxlength="14"/></td>
                            <td>
                              <i class="fa fa-arrow-circle-up" aria-hidden="true"></i> 
                              <i class="fa fa-arrow-circle-down" aria-hidden="true"></i>
                              <i class="fa fa-times-circle" aria-hidden="true"></i>
                            </td>
                        </tr>
                        {% endfor %}
                        <tr class="add-options">
                          <td></td>
                          <td><p class="add-opt">+ Add Option</p></td><td></td>
                        </tr>
                      </table>
                    </div>

                    <p class="show-variation-2" style={% if variation.variation2Name %} "display:none" {% else %} "display:block" {% endif %}>Enable Option 2</p>
                    <p class="disable-variation-2" style={% if variation.variation2Name %} "display:block" {% else %} "display:none" {% endif %}>Disable Option 2</p>
                    <div class="variation-2" style={% if variation.variation2Name %} "display:block" {% else %} "display:none" {% endif %}>
                      <label class="control-label" for="input-variation">Option 2</label>
                        <table class="table">
                        <tr class="variation-name">
                          <td>Name</td>
                          <td><input type="text" placeholder="Variation Name" value="{{ variation.variation2Name }}" name="v2-name" class="form-control" maxlength="14"/></td><td></td>
                        </tr>
                        <tr class="v2-option-tr">
                          <td>Options</td>
                          <td><input type="text" placeholder="Enter Options. Eg:Red" value="{{ variation.variation2Options[0] }}" class="form-control" maxlength="14"/></td>
                          <td>
                            <i class="fa fa-arrow-circle-up" aria-hidden="true"></i> 
                            <i class="fa fa-arrow-circle-down" aria-hidden="true"></i>
                            <i class="fa fa-times-circle" aria-hidden="true"></i>
                          </td>
                        </tr>
                          {% for n in variation.variation2Options|slice(1, variation.variation2Options|length) %}
                          <tr class="v2-option-tr">
                            <td></td>
                            <td><input type="text" placeholder="Enter Options. Eg:Red" value="{{ n }}" class="form-control" maxlength="14"/></td>
                            <td>
                              <i class="fa fa-arrow-circle-up" aria-hidden="true"></i> 
                              <i class="fa fa-arrow-circle-down" aria-hidden="true"></i>
                              <i class="fa fa-times-circle" aria-hidden="true"></i>
                            </td>
                        </tr>
                        {% endfor %}
                        <tr class="add-options">
                          <td></td>
                          <td><p class="add-opt">+ Add Option</p></td><td></td>
                        </tr>
                        </table>
                    </div>

                    <label class="control-label">Option Information</label>
                    <div class="vi-container">
                      <div class="vi-price cell"><input type="number" placeholder="Price" name="o-price" min="0" maxlength="7"></div>
                      <div class="vi-stock cell"><input type="number" placeholder="Stock" min="0" maxlength="4"></div>
                      <div class="vi-sku cell"><input type="text" placeholder="SKU" maxlength="12" ></div>
                      <div class="vi-apply-button cell">APPLY ALL</div>
                    </div>

                    <label class="control-label">Options List</label>
                    {% if variation.variationList %}
                    <div class="variation-list-container {% if variation.variation2Name %} v2-enabled {% endif %}">
                      <div class="vl-header vl-row">
                        <div class="vl-1-name cell">{{ variation.variation1Name }}</div>
                        {% if variation.variation2Name %}
                          <div class="vl-2-name cell">{{ variation.variation2Name }}</div>
                        {% endif %}
                        <div class="cell">Price</div>
                        <div class="cell">Stock</div>
                        <div class="cell">SKU</div>
                      </div>

                      {% if variation.variationList|length > 0 %}
                      {% for key, value in variation.variationList %}
                      <div class="vl-content vl-row">
                        <div class="vl-1-option cell">{{ key }}</div>
                        <div class="vl-info-container">
                        
                          {% if variation.variation2Name and variation.variation2Options > 0 %}
                            {% for k, v in value %}
                            <div class="vl-ic-row">
                              <div class="vl-2-option cell">{{ k }}</div>
                              <div class="vl-price cell"><input type="number" placeholder="Price" value="{{ v.price }}" step="1" maxlength="7"></div>
                              <div class="vl-stock cell"><input type="number" placeholder="Stock" value="{{ v.stock }}" min="0" maxlength="4"></div>
                              <div class="vl-sku cell"><input type="text" placeholder="SKU" value="{{ v.sku }}" maxlength="12"></div>
                            </div>
                            {% endfor %}
                          {% else %}
                            <div class="vl-ic-row">
                              <div class="vl-price cell"><input type="number" placeholder="Price" value="{{ value.price }}" step="1" maxlength="7"></div>
                              <div class="vl-stock cell"><input type="number" placeholder="Stock" value="{{ value.stock }}" min="0" maxlength="4"></div>
                              <div class="vl-sku cell"><input type="text" placeholder="SKU" value="{{ value.sku }}" maxlength="12"></div>
                            </div>
                          {% endif %}

                        </div>
                      </div>
                      {% endfor %}
                      {% else %}
                      <div class="vl-content vl-row">
                        <div class="vl-1-option cell">Option</div>
                        <div class="vl-info-container">
                          <div class="vl-ic-row">
                            <div class="vl-price cell"><input type="number" placeholder="Price" name="o-price" min="0" maxlength="7"></div>
                            <div class="vl-stock cell"><input type="number" placeholder="Stock" min="0" max="999"></div>
                            <div class="vl-sku cell"><input type="text" placeholder="SKU" maxlength="12"></div>
                          </div>
                        </div>
                      </div>
                      {% endif %}
                    </div>  

                    {% else %}
                    <div class="variation-list-container">
                      <div class="vl-header vl-row">
                        <div class="vl-1-name cell">Name</div>
                        <div class="cell">Price</div>
                        <div class="cell">Stock</div>
                        <div class="cell">SKU</div>
                      </div>
                      <div class="vl-content vl-row">
                        <div class="vl-1-option cell">Option</div>
                        <div class="vl-info-container">
                          <div class="vl-ic-row">
                            <div class="vl-price cell"><input type="number" placeholder="Price" name="o-price" min="0" maxlength="7"></div>
                            <div class="vl-stock cell"><input type="number" placeholder="Stock" min="0" max="999"></div>
                            <div class="vl-sku cell"><input type="text" placeholder="SKU" maxlength="12"></div>
                          </div>
                        </div>
                      </div>
                    </div>
                    {% endif %}
                    
                  </div>
                </div>
              </div>

              <div class="form-group">
                <label class="col-sm-2 control-label"><span data-toggle="tooltip" title="{{ help_minimum }}">Media Management</span></label>
                <div class="col-sm-10">
                  <label><span>Product Image</span></label>
                  <div class="drop-image-container product-img">
                    <div class="img-box-container"> <div class="img-box"></div> <input type="file" name="prod-img[]" multiple="multiple" accept="image/*"> <div class="delete-img">&#10006;</div> </div>
                    <div class="img-box-container"> <div class="img-box"></div> <input type="file" name="prod-img[]" multiple="multiple" accept="image/*"> <div class="delete-img">&#10006;</div> </div>
                    <div class="img-box-container"> <div class="img-box"></div> <input type="file" name="prod-img[]" multiple="multiple" accept="image/*"> <div class="delete-img">&#10006;</div> </div>
                    <div class="img-box-container"> <div class="img-box"></div> <input type="file" name="prod-img[]" multiple="multiple" accept="image/*"> <div class="delete-img">&#10006;</div> </div>
                    <div class="img-box-container"> <div class="img-box"></div> <input type="file" name="prod-img[]" multiple="multiple" accept="image/*"> <div class="delete-img">&#10006;</div> </div>
                    <div class="img-box-container"> <div class="img-box"></div> <input type="file" name="prod-img[]" multiple="multiple" accept="image/*"> <div class="delete-img">&#10006;</div> </div>
                    <div class="img-box-container"> <div class="img-box"></div> <input type="file" name="prod-img[]" multiple="multiple" accept="image/*"> <div class="delete-img">&#10006;</div> </div>
                    <div class="img-box-container"> <div class="img-box"></div> <input type="file" name="prod-img[]" multiple="multiple" accept="image/*"> <div class="delete-img">&#10006;</div> </div>
                    <div class="img-box-container"> <div class="img-box"></div> <input type="file" name="prod-img[]" multiple="multiple" accept="image/*"> <div class="delete-img">&#10006;</div> </div>
                  </div>

                  <div class="variation-img-wrapper" style="margin-top:30px">
                    {% if variation.variation1Options and variation.variation1Options|length > 0 %}
                    <label><span>Variation 1</span></label>
                    <div class="drop-image-container var-img">
                        {% for v in variation.variation1Options %}
                          <div class="img-box-container"> 
                            <div class="img-box"></div> <input type="file" name="var-img[]" multiple="multiple" accept="image/*">
                            <p class="img-p">{{ v }}</p>
                            <div class="delete-img">&#10006;</div>
                          </div>
                        {% endfor %}
                    </div>
                    {% endif %}
                  </div>  
                </div>
              </div>

              <div class="form-group">
                <label class="col-sm-2 control-label" for="input-minimum"><span data-toggle="tooltip" title="{{ help_minimum }}">{{ entry_minimum }}</span></label>
                <div class="col-sm-10">
                  <input type="text" name="minimum" value="{{ minimum }}" placeholder="{{ entry_minimum }}" id="input-minimum" class="form-control"/>
                </div>
              </div>
              <div class="form-group">
                <label class="col-sm-2 control-label" for="input-subtract">{{ entry_subtract }}</label>
                <div class="col-sm-10">
                  <select name="subtract" id="input-subtract" class="form-control">


                    {% if subtract %}


                      <option value="1" selected="selected">{{ text_yes }}</option>
                      <option value="0">{{ text_no }}</option>


                    {% else %}


                      <option value="1">{{ text_yes }}</option>
                      <option value="0" selected="selected">{{ text_no }}</option>


                    {% endif %}


                  </select>
                </div>
              </div>
              <div class="form-group">
                <label class="col-sm-2 control-label" for="input-stock-status"><span data-toggle="tooltip" title="{{ help_stock_status }}">{{ entry_stock_status }}</span></label>
                <div class="col-sm-10">
                  <select name="stock_status_id" id="input-stock-status" class="form-control">


                    {% for stock_status in stock_statuses %}
                      {% if stock_status.stock_status_id == stock_status_id %}


                        <option value="{{ stock_status.stock_status_id }}" selected="selected">{{ stock_status.name }}</option>


                      {% else %}


                        <option value="{{ stock_status.stock_status_id }}">{{ stock_status.name }}</option>


                      {% endif %}
                    {% endfor %}


                  </select>
                </div>
              </div>
              <div class="form-group">
                <label class="col-sm-2 control-label">{{ entry_shipping }}</label>
                <div class="col-sm-10">
                  <label class="radio-inline"> {% if shipping %}
                      <input type="radio" name="shipping" value="1" checked="checked"/>
                      {{ text_yes }}
                    {% else %}
                      <input type="radio" name="shipping" value="1"/>
                      {{ text_yes }}
                    {% endif %} </label> <label class="radio-inline"> {% if not shipping %}
                      <input type="radio" name="shipping" value="0" checked="checked"/>
                      {{ text_no }}
                    {% else %}
                      <input type="radio" name="shipping" value="0"/>
                      {{ text_no }}
                    {% endif %} </label>
                </div>
              </div>
              <div class="form-group">
                <label class="col-sm-2 control-label" for="input-date-available">{{ entry_date_available }}</label>
                <div class="col-sm-3">
                  <div class="input-group date">
                    <input type="text" name="date_available" value="{{ date_available }}" placeholder="{{ entry_date_available }}" data-date-format="YYYY-MM-DD" id="input-date-available" class="form-control"/> <span class="input-group-btn">
                    <button class="btn btn-default" type="button"><i class="fa fa-calendar"></i></button>
                    </span></div>
                </div>
              </div>
              <div class="form-group">
                <label class="col-sm-2 control-label" for="input-length">{{ entry_dimension }}</label>
                <div class="col-sm-10">
                  <div class="row">
                    <div class="col-sm-4">
                      <input type="text" name="length" value="{{ length }}" placeholder="{{ entry_length }}" id="input-length" class="form-control"/>
                    </div>
                    <div class="col-sm-4">
                      <input type="text" name="width" value="{{ width }}" placeholder="{{ entry_width }}" id="input-width" class="form-control"/>
                    </div>
                    <div class="col-sm-4">
                      <input type="text" name="height" value="{{ height }}" placeholder="{{ entry_height }}" id="input-height" class="form-control"/>
                    </div>
                  </div>
                </div>
              </div>
              <div class="form-group">
                <label class="col-sm-2 control-label" for="input-length-class">{{ entry_length_class }}</label>
                <div class="col-sm-10">
                  <select name="length_class_id" id="input-length-class" class="form-control">


                    {% for length_class in length_classes %}
                      {% if length_class.length_class_id == length_class_id %}


                        <option value="{{ length_class.length_class_id }}" selected="selected">{{ length_class.title }}</option>


                      {% else %}


                        <option value="{{ length_class.length_class_id }}">{{ length_class.title }}</option>


                      {% endif %}
                    {% endfor %}


                  </select>
                </div>
              </div>
              <div class="form-group">
                <label class="col-sm-2 control-label" for="input-weight">{{ entry_weight }}</label>
                <div class="col-sm-10">
                  <input type="text" name="weight" value="{{ weight }}" placeholder="{{ entry_weight }}" id="input-weight" class="form-control"/>
                </div>
              </div>
              <div class="form-group">
                <label class="col-sm-2 control-label" for="input-weight-class">{{ entry_weight_class }}</label>
                <div class="col-sm-10">
                  <select name="weight_class_id" id="input-weight-class" class="form-control">


                    {% for weight_class in weight_classes %}
                      {% if weight_class.weight_class_id == weight_class_id %}


                        <option value="{{ weight_class.weight_class_id }}" selected="selected">{{ weight_class.title }}</option>


                      {% else %}


                        <option value="{{ weight_class.weight_class_id }}">{{ weight_class.title }}</option>


                      {% endif %}
                    {% endfor %}


                  </select>
                </div>
              </div>
              <div class="form-group">
                <label class="col-sm-2 control-label" for="input-status">{{ entry_status }}</label>
                <div class="col-sm-10">
                  <select name="status" id="input-status" class="form-control">


                    {% if status %}


                      <option value="1" selected="selected">{{ text_enabled }}</option>
                      <option value="0">{{ text_disabled }}</option>


                    {% else %}


                      <option value="1">{{ text_enabled }}</option>
                      <option value="0" selected="selected">{{ text_disabled }}</option>


                    {% endif %}


                  </select>
                </div>
              </div>
              <div class="form-group">
                <label class="col-sm-2 control-label" for="input-sort-order">{{ entry_sort_order }}</label>
                <div class="col-sm-10">
                  <input type="text" name="sort_order" value="{{ sort_order }}" placeholder="{{ entry_sort_order }}" id="input-sort-order" class="form-control"/>
                </div>
              </div>
            </div>
            <div class="tab-pane" id="tab-links">
              <div class="form-group">
                <label class="col-sm-2 control-label" for="input-manufacturer"><span data-toggle="tooltip" title="{{ help_manufacturer }}">{{ entry_manufacturer }}</span></label>
                <div class="col-sm-10">
                  <input type="text" name="manufacturer" value="{{ manufacturer }}" placeholder="{{ entry_manufacturer }}" id="input-manufacturer" class="form-control"/> <input type="hidden" name="manufacturer_id" value="{{ manufacturer_id }}"/>
                </div>
              </div>
              <div class="form-group">
                <label class="col-sm-2 control-label" for="input-category"><span data-toggle="tooltip" title="{{ help_category }}">{{ entry_category }}</span></label>
                <div class="col-sm-10">
                  <input type="text" name="category" value="" placeholder="{{ entry_category }}" id="input-category" class="form-control"/>
                  <div id="product-category" class="well well-sm" style="height: 150px; overflow: auto;"> {% for product_category in product_categories %}
                      <div id="product-category{{ product_category.category_id }}"><i class="fa fa-minus-circle"></i> {{ product_category.name }}
                        <input type="hidden" name="product_category[]" value="{{ product_category.category_id }}"/>
                      </div>
                    {% endfor %}</div>
                </div>
              </div>
              <div class="form-group">
                <label class="col-sm-2 control-label" for="input-related"><span data-toggle="tooltip" title="{{ help_related }}">{{ entry_related }}</span></label>
                <div class="col-sm-10">
                  <input type="text" name="related" value="" placeholder="{{ entry_related }}" id="input-related" class="form-control"/>
                  <div id="product-related" class="well well-sm" style="height: 150px; overflow: auto;"> {% for product_related in product_relateds %}
                      <div id="product-related{{ product_related.product_id }}"><i class="fa fa-minus-circle"></i> {{ product_related.name }}
                        <input type="hidden" name="product_related[]" value="{{ product_related.product_id }}"/>
                      </div>
                    {% endfor %}</div>
                </div>
              </div>
            </div>

            <div class="tab-pane" id="tab-discount">
              <div class="table-responsive">
                <table id="discount" class="table table-striped table-bordered table-hover">
                  <thead>
                    <tr>
                      <td class="text-left">{{ entry_customer_group }}</td>
                      <td class="text-right">{{ entry_quantity }}</td>
                      <td class="text-right">{{ entry_priority }}</td>
                      <td class="text-right">{{ entry_price }}</td>
                      <td class="text-left">{{ entry_date_start }}</td>
                      <td class="text-left">{{ entry_date_end }}</td>
                      <td></td>
                    </tr>
                  </thead>
                  <tbody>

                    {% set discount_row = 0 %}
                    {% for product_discount in product_discounts %}
                      <tr id="discount-row{{ discount_row }}">
                        <td class="text-left"><select name="product_discount[{{ discount_row }}][customer_group_id]" class="form-control">
                            {% for customer_group in customer_groups %}
                              {% if customer_group.customer_group_id == product_discount.customer_group_id %}
                                <option value="{{ customer_group.customer_group_id }}" selected="selected">{{ customer_group.name }}</option>
                              {% else %}
                                <option value="{{ customer_group.customer_group_id }}">{{ customer_group.name }}</option>
                              {% endif %}
                            {% endfor %}
                          </select></td>
                        <td class="text-right"><input type="text" name="product_discount[{{ discount_row }}][quantity]" value="{{ product_discount.quantity }}" placeholder="{{ entry_quantity }}" class="form-control"/></td>
                        <td class="text-right"><input type="text" name="product_discount[{{ discount_row }}][priority]" value="{{ product_discount.priority }}" placeholder="{{ entry_priority }}" class="form-control"/></td>
                        <td class="text-right"><input type="text" name="product_discount[{{ discount_row }}][price]" value="{{ product_discount.price }}" placeholder="{{ entry_price }}" class="form-control"/></td>
                        <td class="text-left" style="width: 20%;">
                          <div class="input-group date">
                            <input type="text" name="product_discount[{{ discount_row }}][date_start]" value="{{ product_discount.date_start }}" placeholder="{{ entry_date_start }}" data-date-format="YYYY-MM-DD" class="form-control"/> <span class="input-group-btn">
                        <button class="btn btn-default" type="button"><i class="fa fa-calendar"></i></button>
                        </span></div>
                        </td>
                        <td class="text-left" style="width: 20%;">
                          <div class="input-group date">
                            <input type="text" name="product_discount[{{ discount_row }}][date_end]" value="{{ product_discount.date_end }}" placeholder="{{ entry_date_end }}" data-date-format="YYYY-MM-DD" class="form-control"/> <span class="input-group-btn">
                        <button class="btn btn-default" type="button"><i class="fa fa-calendar"></i></button>
                        </span></div>
                        </td>
                        <td class="text-left"><button type="button" onclick="$('#discount-row{{ discount_row }}').remove();" data-toggle="tooltip" title="{{ button_remove }}" class="btn btn-danger"><i class="fa fa-minus-circle"></i></button></td>
                      </tr>
                      {% set discount_row = discount_row + 1 %}
                    {% endfor %}
                  </tbody>

                  <tfoot>
                    <tr>
                      <td colspan="6"></td>
                      <td class="text-left"><button type="button" onclick="addDiscount();" data-toggle="tooltip" title="{{ button_discount_add }}" class="btn btn-primary"><i class="fa fa-plus-circle"></i></button></td>
                    </tr>
                  </tfoot>
                </table>
              </div>
            </div>
            <div class="tab-pane" id="tab-special">
              <div class="table-responsive">
                <table id="special" class="table table-striped table-bordered table-hover">
                  <thead>
                    <tr>
                      <td class="text-left">{{ entry_customer_group }}</td>
                      <td class="text-right">{{ entry_priority }}</td>
                      <td class="text-right">{{ entry_price }}</td>
                      <td class="text-left">{{ entry_date_start }}</td>
                      <td class="text-left">{{ entry_date_end }}</td>
                      <td></td>
                    </tr>
                  </thead>
                  <tbody>

                    {% set special_row = 0 %}
                    {% for product_special in product_specials %}
                      <tr id="special-row{{ special_row }}">
                        <td class="text-left"><select name="product_special[{{ special_row }}][customer_group_id]" class="form-control">


                            {% for customer_group in customer_groups %}
                              {% if customer_group.customer_group_id == product_special.customer_group_id %}


                                <option value="{{ customer_group.customer_group_id }}" selected="selected">{{ customer_group.name }}</option>


                              {% else %}


                                <option value="{{ customer_group.customer_group_id }}">{{ customer_group.name }}</option>


                              {% endif %}
                            {% endfor %}


                          </select></td>
                        <td class="text-right"><input type="text" name="product_special[{{ special_row }}][priority]" value="{{ product_special.priority }}" placeholder="{{ entry_priority }}" class="form-control"/></td>
                        <td class="text-right"><input type="text" name="product_special[{{ special_row }}][price]" value="{{ product_special.price }}" placeholder="{{ entry_price }}" class="form-control"/></td>
                        <td class="text-left" style="width: 20%;">
                          <div class="input-group date">
                            <input type="text" name="product_special[{{ special_row }}][date_start]" value="{{ product_special.date_start }}" placeholder="{{ entry_date_start }}" data-date-format="YYYY-MM-DD" class="form-control"/> <span class="input-group-btn">
                        <button class="btn btn-default" type="button"><i class="fa fa-calendar"></i></button>
                        </span></div>
                        </td>
                        <td class="text-left" style="width: 20%;">
                          <div class="input-group date">
                            <input type="text" name="product_special[{{ special_row }}][date_end]" value="{{ product_special.date_end }}" placeholder="{{ entry_date_end }}" data-date-format="YYYY-MM-DD" class="form-control"/> <span class="input-group-btn">
                        <button class="btn btn-default" type="button"><i class="fa fa-calendar"></i></button>
                        </span></div>
                        </td>
                        <td class="text-left"><button type="button" onclick="$('#special-row{{ special_row }}').remove();" data-toggle="tooltip" title="{{ button_remove }}" class="btn btn-danger"><i class="fa fa-minus-circle"></i></button></td>
                      </tr>
                      {% set special_row = special_row + 1 %}
                    {% endfor %}
                  </tbody>

                  <tfoot>
                    <tr>
                      <td colspan="5"></td>
                      <td class="text-left"><button type="button" onclick="addSpecial();" data-toggle="tooltip" title="{{ button_special_add }}" class="btn btn-primary"><i class="fa fa-plus-circle"></i></button></td>
                    </tr>
                  </tfoot>
                </table>
              </div>
            </div>
            
          </div>
        </form>
      </div>
    </div>
  </div>
  <link href="view/javascript/codemirror/lib/codemirror.css" rel="stylesheet"/>
  <link href="view/javascript/codemirror/theme/monokai.css" rel="stylesheet"/>
  <script type="text/javascript" src="view/javascript/codemirror/lib/codemirror.js"></script>
  <script type="text/javascript" src="view/javascript/codemirror/lib/xml.js"></script>
  <script type="text/javascript" src="view/javascript/codemirror/lib/formatting.js"></script>
  <script type="text/javascript" src="view/javascript/summernote/summernote.js"></script>
  <link href="view/javascript/summernote/summernote.css" rel="stylesheet"/>
  <script type="text/javascript" src="view/javascript/summernote/summernote-image-attributes.js"></script>
  <script type="text/javascript" src="view/javascript/summernote/opencart.js"></script>
  <script type="text/javascript"><!--
  // Manufacturer
  $('input[name=\'manufacturer\']').autocomplete({
	  'source': function(request, response) {
		  $.ajax({
			  url: 'index.php?route=catalog/manufacturer/autocomplete&user_token={{ user_token }}&filter_name=' + encodeURIComponent(request),
			  dataType: 'json',
			  success: function(json) {
				  json.unshift({
					  manufacturer_id: 0,
					  name: '{{ text_none }}'
				  });

				  response($.map(json, function(item) {
					  return {
						  label: item['name'],
						  value: item['manufacturer_id']
					  }
				  }));
			  }
		  });
	  },
	  'select': function(item) {
		  $('input[name=\'manufacturer\']').val(item['label']);
		  $('input[name=\'manufacturer_id\']').val(item['value']);
	  }
  });

  // Category
  $('input[name=\'category\']').autocomplete({
	  'source': function(request, response) {
		  $.ajax({
			  url: 'index.php?route=catalog/category/autocomplete&user_token={{ user_token }}&filter_name=' + encodeURIComponent(request),
			  dataType: 'json',
			  success: function(json) {
				  response($.map(json, function(item) {
					  return {
						  label: item['name'],
						  value: item['category_id']
					  }
				  }));
			  }
		  });
	  },
	  'select': function(item) {
		  $('input[name=\'category\']').val('');

		  $('#product-category' + item['value']).remove();

		  $('#product-category').append('<div id="product-category' + item['value'] + '"><i class="fa fa-minus-circle"></i> ' + item['label'] + '<input type="hidden" name="product_category[]" value="' + item['value'] + '" /></div>');
	  }
  });

  $('#product-category').delegate('.fa-minus-circle', 'click', function() {
	  $(this).parent().remove();
  });

  // Filter
  $('input[name=\'filter\']').autocomplete({
	  'source': function(request, response) {
		  $.ajax({
			  url: 'index.php?route=catalog/filter/autocomplete&user_token={{ user_token }}&filter_name=' + encodeURIComponent(request),
			  dataType: 'json',
			  success: function(json) {
				  response($.map(json, function(item) {
					  return {
						  label: item['name'],
						  value: item['filter_id']
					  }
				  }));
			  }
		  });
	  },
	  'select': function(item) {
		  $('input[name=\'filter\']').val('');

		  $('#product-filter' + item['value']).remove();

		  $('#product-filter').append('<div id="product-filter' + item['value'] + '"><i class="fa fa-minus-circle"></i> ' + item['label'] + '<input type="hidden" name="product_filter[]" value="' + item['value'] + '" /></div>');
	  }
  });

  $('#product-filter').delegate('.fa-minus-circle', 'click', function() {
	  $(this).parent().remove();
  });

  // Related
  $('input[name=\'related\']').autocomplete({
	  'source': function(request, response) {
		  $.ajax({
			  url: 'index.php?route=catalog/product/autocomplete&user_token={{ user_token }}&filter_name=' + encodeURIComponent(request),
			  dataType: 'json',
			  success: function(json) {
				  response($.map(json, function(item) {
					  return {
						  label: item['name'],
						  value: item['product_id']
					  }
				  }));
			  }
		  });
	  },
	  'select': function(item) {
		  $('input[name=\'related\']').val('');

		  $('#product-related' + item['value']).remove();

		  $('#product-related').append('<div id="product-related' + item['value'] + '"><i class="fa fa-minus-circle"></i> ' + item['label'] + '<input type="hidden" name="product_related[]" value="' + item['value'] + '" /></div>');
	  }
  });

  $('#product-related').delegate('.fa-minus-circle', 'click', function() {
	  $(this).parent().remove();
  });
  //--></script>
  
  <script type="text/javascript"><!--
  var discount_row = {{ discount_row }};

  function addDiscount() {
	  html = '<tr id="discount-row' + discount_row + '">';
	  html += '  <td class="text-left"><select name="product_discount[' + discount_row + '][customer_group_id]" class="form-control">';
    {% for customer_group in customer_groups %}
	  html += '    <option value="{{ customer_group.customer_group_id }}">{{ customer_group.name|escape('js') }}</option>';
    {% endfor %}
	  html += '  </select></td>';
	  html += '  <td class="text-right"><input type="text" name="product_discount[' + discount_row + '][quantity]" value="" placeholder="{{ entry_quantity }}" class="form-control" /></td>';
	  html += '  <td class="text-right"><input type="text" name="product_discount[' + discount_row + '][priority]" value="" placeholder="{{ entry_priority }}" class="form-control" /></td>';
	  html += '  <td class="text-right"><input type="text" name="product_discount[' + discount_row + '][price]" value="" placeholder="{{ entry_price }}" class="form-control" /></td>';
	  html += '  <td class="text-left" style="width: 20%;"><div class="input-group date"><input type="text" name="product_discount[' + discount_row + '][date_start]" value="" placeholder="{{ entry_date_start }}" data-date-format="YYYY-MM-DD" class="form-control" /><span class="input-group-btn"><button type="button" class="btn btn-default"><i class="fa fa-calendar"></i></button></span></div></td>';
	  html += '  <td class="text-left" style="width: 20%;"><div class="input-group date"><input type="text" name="product_discount[' + discount_row + '][date_end]" value="" placeholder="{{ entry_date_end }}" data-date-format="YYYY-MM-DD" class="form-control" /><span class="input-group-btn"><button type="button" class="btn btn-default"><i class="fa fa-calendar"></i></button></span></div></td>';
	  html += '  <td class="text-left"><button type="button" onclick="$(\'#discount-row' + discount_row + '\').remove();" data-toggle="tooltip" title="{{ button_remove }}" class="btn btn-danger"><i class="fa fa-minus-circle"></i></button></td>';
	  html += '</tr>';

	  $('#discount tbody').append(html);

	  $('.date').datetimepicker({
		  pickTime: false
	  });

	  discount_row++;
  }

  //--></script>
  <script type="text/javascript"><!--
  var special_row = {{ special_row }};

  function addSpecial() {
	  html = '<tr id="special-row' + special_row + '">';
	  html += '  <td class="text-left"><select name="product_special[' + special_row + '][customer_group_id]" class="form-control">';
    {% for customer_group in customer_groups %}
	  html += '      <option value="{{ customer_group.customer_group_id }}">{{ customer_group.name|escape('js') }}</option>';
    {% endfor %}
	  html += '  </select></td>';
	  html += '  <td class="text-right"><input type="text" name="product_special[' + special_row + '][priority]" value="" placeholder="{{ entry_priority }}" class="form-control" /></td>';
	  html += '  <td class="text-right"><input type="text" name="product_special[' + special_row + '][price]" value="" placeholder="{{ entry_price }}" class="form-control" /></td>';
	  html += '  <td class="text-left" style="width: 20%;"><div class="input-group date"><input type="text" name="product_special[' + special_row + '][date_start]" value="" placeholder="{{ entry_date_start }}" data-date-format="YYYY-MM-DD" class="form-control" /><span class="input-group-btn"><button type="button" class="btn btn-default"><i class="fa fa-calendar"></i></button></span></div></td>';
	  html += '  <td class="text-left" style="width: 20%;"><div class="input-group date"><input type="text" name="product_special[' + special_row + '][date_end]" value="" placeholder="{{ entry_date_end }}" data-date-format="YYYY-MM-DD" class="form-control" /><span class="input-group-btn"><button type="button" class="btn btn-default"><i class="fa fa-calendar"></i></button></span></div></td>';
	  html += '  <td class="text-left"><button type="button" onclick="$(\'#special-row' + special_row + '\').remove();" data-toggle="tooltip" title="{{ button_remove }}" class="btn btn-danger"><i class="fa fa-minus-circle"></i></button></td>';
	  html += '</tr>';

	  $('#special tbody').append(html);

	  $('.date').datetimepicker({
		  language: '{{ datepicker }}',
		  pickTime: false
	  });

	  special_row++;
  }

  //--></script>
  <script type="text/javascript"><!--
  $('.date').datetimepicker({
	  language: '{{ datepicker }}',
	  pickTime: false
  });

  $('.time').datetimepicker({
	  language: '{{ datepicker }}',
	  pickDate: false
  });

  $('.datetime').datetimepicker({
	  language: '{{ datepicker }}',
	  pickDate: true,
	  pickTime: true
  });
  //--></script>
  <script type="text/javascript"><!--
  $('#language a:first').tab('show');
  $('#option a:first').tab('show');
  //--></script>
</div>
{{ footer }} 

//add on code
<script type="text/javascript">

  var variation1 = {% if variation.variation1Name %} 1 {% else %} 0 {% endif %};
  var variation2 = {% if variation.variation2Name %} 1 {% else %} 0 {% endif %};
  var variationEnabled = 0;

  $('.enable-variation, .disable-variation').on('click', function() {
	  $('.variation-container, .disable-variation, .enable-variation').toggle();
    if ($(this).hasClass('enable-variation')) {
      enableVariation();
      variationEnabled = 1;
    } else {
      variationEnabled = 0; //close variation
    }
  });

  
$('.edit-product').on('click', function() {
      var data = $("#form-product").serialize();
      var product_id = {{ product_id }};
      var variation = generateVariation();

      $.ajax({
        url: 'index.php?route=catalog/product/editProduct&user_token={{ user_token }}',
        type: 'post',
        data: {data:data, product_id:product_id, variation: variation},
        dataType: 'json',
        beforeSend: function() {
          $('.success-message, .error-message').css("display", "none");
		    },
        success: function(json) {
          if (json.success) {
            uploadProductImages(variation);
            console.log(json);
          } else {
            alertify.alert("Warning", json.error);
          }
		   },
        error: function(xhr, ajaxOptions, thrownError) {
            alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
        }
      }); 

});

$('.add-product').on('click', function() {
      var data = $("#form-product").serialize();
      var variation = generateVariation();

      $.ajax({
          url: 'index.php?route=catalog/product/addProduct&user_token={{ user_token }}',
          type: 'post',
          data: {data:data,variation:variation},
          dataType: 'json',
          beforeSend: function() {
            $('.success-message, .error-message').css("display", "none");
          },
          success: function(json) {
              if (json.success && json.product_id) {
                uploadProductImages(json.product_id);
              } else {
                var warning = json.error.warning;
                var text = "";
                $.each( warning, function( k, v) {
                  text+= "- "+v+"</br>";
                });
                alertify.alert("Warning", text);
              }
        },
          error: function(xhr, ajaxOptions, thrownError) {
              alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
          }
      });
});

function uploadProductImages(new_product_id = 0) {
  var formImage = new FormData();
  var product_id = new_product_id > 0 ? new_product_id : {{ product_id }};
  var url = "index.php?route=catalog/product/edit&user_token={{ user_token }}&product_id=" + product_id;
  $.each(uploadImages, function( i, value ) {
    var filetype = value.name.split('.')[1];
    formImage.append('file[]', value, 'img_' + i + '.' + filetype);
  });

  $.each(variationImages, function(i, value) {
    var filetype = value.name.split('.')[1];
    formImage.append('file[]', value, 'var_' + i + '.' + filetype);
  });

  $.ajax({
    url: 'index.php?route=common/filemanager/uploadProductImages&user_token={{ user_token }}&product_id='+ product_id,
    type: 'post',
    data: formImage,
    dataType: 'json',
    cache: false,
    contentType: false,
    processData: false,
    beforeSend: function() {
      
    },
    success: function(json) {
      if (json.success) {
        if (new_product_id > 0) {
          alertify.alert("Product Added Succesfully", function(){ 
            var url = url;
            window.location.replace(url);
          });
        } else {
          alertify.alert("Product Updated", function(){ 
            window.location.reload();
          });
        }
      } else {
        alertify.alert("Warning", json.error, function() { window.location.replace(url) });
      }
  },
    error: function(xhr, ajaxOptions, thrownError) {
        alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
    }
  });
}


$('.show-variation-2, .disable-variation-2').on('click', function() {
  $('.variation-2, .show-variation-2, .disable-variation-2').toggle();
  if (variation2 == 0) {
    enableVariation2();
    variation2 = 1;  
  } else {
    disableVariation2();
    variation2 = 0;  
  }
  
});

  function enableVariation() {
    $('.var-img').html('<div class="img-box-container"> <div class="img-box"></div> <input type="file" name="var-img[]" multiple="multiple" accept="image/*"> </div>');
  }

  function enableVariation2() {
    $('.vl-header.vl-row .vl-1-name').after('<div class="vl-2-name cell">Name</div>');
    $('.vl-ic-row').prepend('<div class="vl-2-option cell">Option</div>');
    $('.variation-list-container').addClass('v2-enabled');
    addVariation2Row();
  }

  function disableVariation2() {
    $('.v2-option-tr:not(:first)').remove();
    $('.variation-2').find('input').val("");

    $('div.vl-2-name, div.vl-2-option').remove();
    $('.variation-list-container').removeClass('v2-enabled');
    $('.vl-info-container').find('.vl-ic-row:not(:first)').remove();
  }

  $('p.add-opt').on('click', function() {
    var tb = $(this).closest('table').hasClass('table-v1') ? 1 : 2;

    $(this).closest('tr').before('<tr class="v'+tb+'-option-tr"><td></td><td><input type="text" placeholder="Enter Options. Eg:Red" class="form-control" maxlength="14"></td><td>'
                            +' <i class="fa fa-arrow-circle-up" aria-hidden="true"></i>'
                            +' <i class="fa fa-arrow-circle-down" aria-hidden="true"></i>'
                            +' <i class="fa fa-times-circle" aria-hidden="true"></i> </td></tr>');

    if (tb == 1) {
      addVariation1Row();
    } else if (tb == 2) {
      addVariation2Row();
    }
  });

  function addVariation1Row() {
    var html = '<div class="vl-ic-row">'
                + '<div class="vl-price cell"><input type="number" placeholder="Price" step="1" maxlength="7"></div>'
                + '<div class="vl-stock cell"><input type="number" placeholder="Stock" min="0" maxlength="4"></div>'
                + '<div class="vl-sku cell"><input type="text" placeholder="SKU" maxlength="12"></div>'
              + '</div>';

    if (variation2 == 1) { //got variation 2 
      html = "";
      $.each($('.v2-option-tr'), function() {
        html+= '<div class="vl-ic-row">'
                + '<div class="vl-2-option cell">Option</div>'
                + '<div class="vl-price cell"><input type="number" placeholder="Price" step="1" maxlength="7"></div>'
                + '<div class="vl-stock cell"><input type="number" placeholder="Stock" min="0" maxlength="4"></div>'
                + '<div class="vl-sku cell"><input type="text" placeholder="SKU" maxlength="12"></div>'
              + '</div>';
      });
    }              

    $('.variation-list-container').append('<div class="vl-content vl-row">'
                      + '<div class="vl-1-option cell">Option</div>'
                      + '<div class="vl-info-container">' + html + '</div> </div>');
  }

  function addVariation2Row() { 
      if ($('.v2-option-tr').length > 1) {
        $('.vl-info-container').append('<div class="vl-ic-row">'
                                        + '<div class="vl-2-option cell">Option</div>'
                                        + '<div class="vl-price cell"><input type="number" placeholder="Price" step="1" maxlength="7"></div>'
                                        + '<div class="vl-stock cell"><input type="number" placeholder="Stock" min="0" max="999"></div>'
                                        + '<div class="vl-sku cell"><input type="text" placeholder="SKU" maxlength="12"></div>'
                                      + '</div>');
      }
  }

  function deleteVariation1Row() {
    
  }

  //delete row
  $(document).on('click', '.variation-container .fa-times-circle', function() { 
    var trs = $(this).closest('table').find('tr:not(.variation-name, .add-options)');
    var tr = $(this).closest('tr');

    var index = $(this).closest('table').find('.fa-times-circle').index(this); //get which row is this
    var variation = $(this).closest('tr').hasClass('v1-option-tr') ? 'v1' : ($(this).closest('tr').hasClass('v2-option-tr') ? 'v2' : 0);

    if (trs[0] == tr[0]) {

      if (trs.length > 1) {
        
        tr.find('input').val($(trs[1]).find('input').val());
        $(trs[1]).remove();

        //variation list
        if (variation == 'v1') {
          $('.vl-content.vl-row').eq(index).remove();
        } else if (variation == 'v2') {
          $('.vl-info-container').each(function() {
            $(this).find('.vl-ic-row').eq(index).remove();
          });
        }

      } else {
        tr.find('input').val('');
      }
    } else {

      tr.remove();

      //variation list
      if (variation == 'v1') {
        $('.vl-content.vl-row').eq(index).remove();
      } else if (variation == 'v2') {
        $('.vl-info-container').each(function(){
            $(this).find('.vl-ic-row').eq(index).remove();
        });
      }
    }
  });

  //go down function
  $(document).on('click', '.variation-container .fa-arrow-circle-down', function() {
    var trs = $(this).closest('table').find('tr:not(.variation-name, .add-options)');
    var tr = $(this).closest('tr');
    var index = $(this).closest('table').find('.fa-arrow-circle-down').index(this); //get which row is this
    var variation = $(this).closest('tr').hasClass('v1-option-tr') ? 'v1' : ($(this).closest('tr').hasClass('v2-option-tr') ? 'v2' : 0);

    if (trs.length > 1 && (tr[0] != trs[trs.length - 1]) ) {
      var tmp1 = tr.find('input').val();
      var tmp2 = tr.next('tr').find('input').val();
      tr.find('input').val(tmp2);
      tr.next('tr').find('input').val(tmp1);

      if (variation == 'v2') {
        $('.vl-info-container').each(function(){
          var row = $(this).find('.vl-ic-row').eq(index);
          row.next().insertBefore(row);
        });
      } else {
        var row = $('.variation-list-container').find('.vl-content.vl-row').eq(index);
        row.next().insertBefore(row);
      }
      
    }
  });

  // go up function
  $(document).on('click', '.variation-container .fa-arrow-circle-up', function() {
    var trs = $(this).closest('table').find('tr:not(.variation-name, .add-options)');
    var tr = $(this).closest('tr');
    var index = $(this).closest('table').find('.fa-arrow-circle-up').index(this); //get which row is this
    var variation = $(this).closest('tr').hasClass('v1-option-tr') ? 'v1' : ($(this).closest('tr').hasClass('v2-option-tr') ? 'v2' : 0);

    if (trs.length > 1 && (tr[0] != trs[0]) ) {
      var tmp1 = tr.find('input').val();
      var tmp2 = tr.prev('tr').find('input').val();
      tr.find('input').val(tmp2);
      tr.prev('tr').find('input').val(tmp1);

      if (variation == 'v2') {
        $('.vl-info-container').each(function(){
          var row = $(this).find('.vl-ic-row').eq(index);
          row.prev().insertAfter(row);
        });
      } else {
        var row = $('.variation-list-container').find('.vl-content.vl-row').eq(index);
        row.next().insertAfter(row);
      }
    }
  });

  $(document).on('input', 'input[name="v1-name"], input[name="v2-name"]', function() {
    if (this.name == 'v1-name') {
      $('.vl-1-name').text($(this).val());
    } else {
      $('.vl-2-name').text($(this).val());
    }
  });

  $(document).on('input', '.v1-option-tr input, .v2-option-tr input', function() {
    var index = "";
    if ($(this).closest('tr').hasClass('v1-option-tr')) {
      index = $(this).closest('table').find('tr.v1-option-tr input').index(this);
      $('.variation-list-container').find('.vl-1-option').eq(index).text($(this).val());
    } else {
      var text = $(this).val();
      index = $(this).closest('table').find('tr.v2-option-tr input').index(this);
      $('.vl-info-container').each(function() {
          $(this).find('.vl-ic-row').eq(index).find('.vl-2-option').text(text);
      });
    }
      //$('.vl-1-option').text($(this.));
  });

  $(document).on('focusin', '.vi-container input', function() {
    var dv = $(this).closest('div.cell');
    if (dv.hasClass('vi-price')) {
      $('.vl-price').addClass('highlight');
    } else if (dv.hasClass('vi-stock')) {
      $('.vl-stock').addClass('highlight');
    } else if (dv.hasClass('vi-sku')) {
      $('.vl-sku').addClass('highlight');
    }
  });

  $(document).on('focusout', '.vi-container input', function() {
    $('.vl-info-container .cell').removeClass('highlight');
  });

  $(document).on('click', '.vi-apply-button', function() {
    if ($('.vi-price input').val()) {
      $('.vl-price input').val($('.vi-price input').val());
    } 
    
    if ($('.vi-stock input').val()) {
      $('.vl-stock input').val($('.vi-stock input').val());
    }
    
    if ($('.vi-sku input').val()) {
      $('.vl-sku input').val($('.vi-sku input').val());
    }
  });

  function generateVariation() {
    var tmpObj = {};

    if (variationEnabled == 1) {
      $('.vl-content.vl-row').each(function() {
        tmpObj.variation1Name = $('input[name="v1-name"]').val();
        tmpObj.variation1Options = [];
        $('tr.v1-option-tr').each(function() {
          tmpObj.variation1Options.push($(this).find('input').val());
        });

        console.log(variation2);

        if (variation2 == 0) {
          var tmp = {};
          $('.vl-content.vl-row').each(function() {
            tmp[$(this).find('.vl-1-option').text()] = {
              'price' : $(this).find('.vl-price input').val(),
              'stock' : $(this).find('.vl-stock input').val(),
              'sku' : $(this).find('.vl-sku input').val()
            }
          });
          tmpObj.variationList = tmp;
        }
        else {
          tmpObj.variation2Name = $('input[name="v2-name"]').val();
          tmpObj.variation2Options = [];
          $('tr.v2-option-tr').each(function() {
            tmpObj.variation2Options.push($(this).find('input').val());
          });
          var tmp = {};
          $('.vl-content.vl-row').each(function() {
            var tmp2 = {};
            $(this).find('.vl-ic-row').each(function() {
              tmp2[$(this).find('.vl-2-option').text()] = {
                'price' : $(this).find('.vl-price input').val(),
                'stock' : $(this).find('.vl-stock input').val(),
                'sku' : $(this).find('.vl-sku input').val()
              }
            });
            tmp[$(this).find('.vl-1-option').text()] = tmp2;
          });
          tmpObj.variationList = tmp; 
        }
      });
    }
    return tmpObj;
  };

//for max input
  $(document).on('input', '.vi-container input[type="number"]', function() {
    this.value=this.value.slice(0,this.maxLength);
    if (this.name == "o-price") {
      this.value = this.value.match(/^\d+\.?\d{0,2}/); //only allow 2 decimal
    } else {
      $(this).val($(this).val().replace(/\./g, "")); //only allow integer
    }
  });

  //images
  var productImages = "{{ product_images|join(',') }}";
  var productImagesArr = productImages.split(',');
  var variation = {{ variation|json_encode(constant('JSON_PRETTY_PRINT')) }} ;

  $(productImagesArr).each(function(i) {
    var filename = productImagesArr[i].split('/').pop();
    var boxNo = parseInt(filename.split('.')[0].slice(-1)) - 1; //img number

    if (filename.split('_')[0] == 'img') {
      $('.product-img .img-box-container:eq('+ boxNo +')').find('.img-box').addClass('inserted').css("background-image", 'url('+ productImagesArr[i] +')');
    } else if (filename.split('_')[0] == 'var' && variation && variation.variation1Options[boxNo]) {
      $('.var-img .img-box-container:eq('+ boxNo +')').find('.img-box').addClass('inserted').css("background-image", 'url('+ productImagesArr[i] +')');
    }
  });

  $(".img-box").on('dragenter', function(e) {
    e.preventDefault();
  });

  $(".img-box").on('dragover', function(e) {
    e.preventDefault();
  });

  var uploadImages = {};
  var variationImages = {};
  $(".img-box").on('drop', function(e) {
    e.preventDefault();

    var input = $(this);
    var type = $(this).closest('.drop-image-container').hasClass('product-img') ? 'product' : 'variation';
    var currentBox = parseInt($(this).closest('.img-box-container').prevAll().length) + 1;
    var allowInputNo = parseInt($(this).closest('.img-box-container').nextAll().length) + 1;
    var image = e.originalEvent.dataTransfer.files;
    var error = false;

    $(image).each(function(i, file) {
      var imageType = /image.*/;
      if (!file.type.match(imageType)) {
        error = true;
      }
    });

    if (error == true) {
      alert('Only allow images');
    } else {
      if (image.length > allowInputNo) {
        alert('Only allow to input '+ allowInputNo + ' pictures from this box');
      } else {
        var next = input;
        $(image).each(function(i, file) {
          var tmppath = URL.createObjectURL(file);
          //formImage.append('file[]',file);

          if (type == "product") {
            uploadImages[counter] = file;
          } else {
            variationImages[counter] = file;
          }

          next.closest('.img-box-container').find('.img-box').addClass('inserted').css("background-image", 'url('+ tmppath +')');
          next = next.closest('.img-box-container').next();
        });
      }
    }
  });

  $("input[name='prod-img[]'], input[name='var-img[]']").on('change', function(e) {
    var input = $(this);
    var type = $(this).closest('.drop-image-container').hasClass('product-img') ? 'product' : 'variation';
    console.log(type);
    var currentBox = parseInt($(this).closest('.img-box-container').prevAll().length) + 1;
    var allowInputNo = parseInt($(this).closest('.img-box-container').nextAll().length) + 1;

    if (e.target.files.length > allowInputNo) {
      alert('Only allow to input '+ allowInputNo + ' pictures from this box');
    } else {
      var next = input;
      var counter = parseInt(currentBox);
      $(e.target.files).each(function(i, file) {
        var tmppath = URL.createObjectURL(file);
        //formImage.append('file[]',file);

        if (type == "product") {
          uploadImages[counter] = file;
        } else {
          variationImages[counter] = file;
        }

        next.closest('.img-box-container').find('.img-box').addClass('inserted').css("background-image", 'url('+ tmppath +')');
        next = next.closest('.img-box-container').next();
        counter = counter + 1;
      });
      console.log(uploadImages);
      console.log(variationImages);
    }
  });

  $(".img-box").on('click', function(e) {
    $(this).closest('.img-box-container').find('input[type="file"]').trigger('click');
  });

  //delete image
  $('.delete-img').on('click', function(e) {
    var div = $(this).closest('.img-box-container').find('.img-box');
    if (div.hasClass('inserted')) {
      alertify.confirm('Delete Image', 'Are you sure to delete this image?', 
                function(){ 
                  var type = div.closest('.drop-image-container').hasClass('product-img') ? "product" : "variation";
                  var boxNo = parseInt(div.closest('.img-box-container').prevAll().length) + 1;
                  var image = type == 'product' ? "img_" + boxNo : "var_" + boxNo;

                  if (type == "product" && uploadImages[boxNo]) {
                    delete uploadImages[boxNo];
                    div.css("background-image", "").removeClass('inserted');
                  } else if (type == "variation" && variationImages[boxNo]) {
                    delete variationImages[boxNo];
                    div.css("background-image", "").removeClass('inserted');
                  } else {
                    
                    $(productImagesArr).each(function(i) {
                      var filename = productImagesArr[i].split('/').pop();
                      if (filename.split('.')[0] == "img_1") { //cover image not allow to delete
                        alertify.alert("Cover Image is not allowed to delete, you can only change image");
                      }
                      else {
                        if (filename.split('.')[0] == image) { 
                          $.ajax({
                            url: 'index.php?route=common/filemanager/deleteProductImage&user_token={{ user_token }}&product_id='+ {{ product_id }},
                            type: 'post',
                            dataType: 'json',
                            data: {filename:filename},
                            success: function(json) {
                              if (json['error']) {
                                alertify.alert(json['error']);
                              }

                              if (json['success']) {
                                alertify.alert(json['success']);
                                div.css("background-image", "").removeClass('inserted');
                              }
                            },
                            error: function(xhr, ajaxOptions, thrownError) {
                              alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
                            }
                          });
                        }
                      }


                    });

                  }

                } , 
                function(){}

      );
    }
  });

</script>

<style>
.alert {
  display: none;
}

.add-opt {
  cursor: pointer;
  color: #1e91cf;
}

.variation-container .fa {
  cursor: pointer;
  font-size: 18px;
}

.variation-container .fa-times-circle {
  color: red;
  font-size: 19px;
}

.vi-container {
  margin-bottom: 25px;
}

.vi-apply-button.cell {
  background-color: #1e91cf;
  color: white;
  margin-left: 10px;
  cursor: pointer;
}

.variation-list-container {
  border: 1px solid #ddd;
  border-top-width: 0;
  border-left-width: 0;
}

.vl-header.vl-row {
  background-color: #f5f5f5;
}

.vi-container, .vl-header.vl-row, .vl-content.vl-row {
  display: flex;
  margin-left: 0;
}

.vl-1-option.cell {
  flex: 25%;
  align-items: center;
  justify-content: center;
  display: flex;
}

.v2-enabled .vl-1-option.cell {
  flex: 20%;
}

.vl-info-container {
  flex: 4 1 75%;
}

.v2-enabled .vl-info-container {
  flex: 4 1 80%;
}

.vl-ic-row {
    display: flex;
}

.variation-list-container .cell {
  border-bottom-width: 0;
  border-right-width: 0;
}

.variation-list-container .cell.highlight, .variation-list-container .cell.highlight input {
  background-color: #ffe2de;
}

.cell {
  webkit-box-flex: 3;
  flex: 3;
  padding: 10px;
  border: 1px solid #ddd;
  text-align: center;
  color: grey;
  word-break: break-word;
}

.cell input {
    border-top: none;
    border-left: none;
    border-right: none;
    width: 100%;
    text-align: center;
}

.cell input:focus{
    outline: none;
}

input::-webkit-outer-spin-button,
input::-webkit-inner-spin-button {
  -webkit-appearance: none;
  margin: 0;
}

/* Firefox */
input[type=number] {
  -moz-appearance: textfield;
}

.drop-image-container {
	
}

.img-p {
  text-align:center;
}

.img-box-container {
    display: inline-block;
    position: relative;
}

.img-box {
  width: 100px;
  height: 100px;
  margin: 5px;
  border: 2px dashed #07c6f1;
  display: inline-block;
  background-size: contain;
  background-position: center;
  background-repeat: no-repeat;
}

.img-box.inserted:hover {
  
}

.img-box.inserted:before {
  opacity: 0;
}

.img-box:before {
    content: '+';
    color: #07c6f1;
    font-size: 50px;
    display: flex;
    font-family: none;
    width: 100%;
    height: 100%;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    opacity: 1;
}

.drop-image-container input[type="file"] {
  display: none;
}

.drop-image {
	display: none;
}

.delete-img {
    display: none;
    position: absolute;
    top: 0;
    right: 0;
    width: 20px;
    height: 20px;
    background-color: red;
    border-radius: 20px;
    text-align: center;
    line-height: 20px;
    cursor: pointer;
    color: white;
}

.img-box-container:hover > .delete-img {
    display: block;
}

.preview {
	margin: 20px;
    width: 150px;
    height: 150px;
    display: inline-block;
}

.enable-variation, .disable-variation {
    display: inline-block;
    padding: 5px 12px;
    border-radius: 2px;
    cursor: pointer;
}

.enable-variation {
    color: rgb(7, 198, 241);
    border: 1px solid rgb(7, 198, 241);
}

.disable-variation {
    color: red;
    border: 1px solid red;
}

.show-variation-2 {
    cursor: pointer;
    border: 1px solid rgb(7, 198, 241);
    color: rgb(7, 198, 241);
    padding: 5px
}

.disable-variation-2 {
    color: red;
    text-decoration: underline;
    cursor: pointer;
}

</style>